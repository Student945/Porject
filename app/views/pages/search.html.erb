<h1> <p align = "center"> Pages#home</h1>
<p> <p align = "center"> Find me in app/views/pages/home.html.erb</p>

<% if current_user %>
	<% if current_user.full_name.present? %>
	<h3> <%= current_user.full_name %> </h3>
	<%= image_tag(current_user.avatar_thumbnail, :width => '200px') %>
<% else %>
	<% if current_user.avatar.attached?%>
		<h3> <%= current_user.email %> </h3>
           	<%= image_tag(current_user.avatar_thumbnail, :width => '200px') %>

	<%else %>
	        <h3> <%= current_user.email %> </h3>
		<%= image_tag(current_user.avatar_thumbnail, :width => '200px') %>
 	
 	<%end %>
<%end %>

<%= link_to t("edit"), edit_user_registration_path %>
<%= button_to "Logout", destroy_user_session_path, data: {turbo: "false"}, method: :delete %>


<button onclick="window.location.href='/users/<%= current_user.id %>';"><%=t("profile")%></button>

 <div align="right">
    <h1><%=t("lista")%></h1>
    <ul>
      <% @users.each do |user| %>
       <ul> <%= link_to user.full_name, users_path(id: user.id) %><ul>
      <% end %>
    </ul>
  </div>

  <% if @search_results.present? %>
  <h2><%=t("risultati")%></h2>
  <div class="vertical-list">
    <% @search_results.each do |item| %>
      <div class="result-item">
        <h3><%= item["title"][0] %></h3>
        <%=t("feed")+ item["sellerInfo"][0]["feedbackScore"][0].to_i.to_s%>
        <%=t("time")+ item["shippingInfo"][0]["handlingTime"][0].to_i.to_s%>
        <p> <%= t("price")+item["sellingStatus"][0]["currentPrice"][0]["__value__"] %> <%= item["sellingStatus"][0]["currentPrice"][0]["@currencyId"] %></p>
        <p> <%= t("link")%> <%= link_to t("vai"), item["viewItemURL"][0] %></p> 
        <% if item["listingInfo"][0]["buyItNowAvailable"][0]=="true" %>
            <%= t("iexp") %>
        <% end %>
        <% if current_user && !@researches_item_id.include?(item["itemId"][0].to_i)%>
            <%= link_to t("save"), new_user_research_path(current_user.id, title: item["title"][0], price: item["sellingStatus"][0]["currentPrice"][0]["__value__"], location: item["location"][0] + "  " + item["country"][0], item_id: item["itemId"][0], url: item["viewItemURL"][0], feed:item["sellerInfo"][0]["feedbackScore"][0].to_i ,time: item["shippingInfo"][0]["handlingTime"][0].to_i ) %>
        <% end %>
        <% for element in @resitem%>
            <%if element[0].to_i==item["itemId"][0].to_i && element[1].to_i> item["shippingInfo"][0]["shippingServiceCost"][0]["__value__"].to_i%>
                <p><%= t("low")%></p>
            <%end %>
        <%end %>
        <% if current_user && !@reviews_item_id.include?(item["itemId"][0].to_i)%>
            <%= link_to t("rec"), new_user_review_path(current_user.id, title: item["title"][0], item_id: item["itemId"][0]) %>
        <% end %>
      </div>
    <% end %>
  </div>
<% else %>
  <p><%=t("nores")%></p>
<% end %>



<% else %>
<p align = "center"> <%= link_to "Login", new_user_session_path %>  <%= link_to "Create Account", new_user_registration_path %>

<% if @search_results.present? %>
  <h2>t("risultati")</h2>
  <div class="vertical-list">
    <% @search_results.each do |item| %>
      <div class="result-item">
        <h3><%= item["title"][0] %></h3>
        <%=t("feed")+ item["sellerInfo"][0]["feedbackScore"][0].to_i.to_s%>
        <%=t("time")+ item["shippingInfo"][0]["handlingTime"][0].to_i.to_s%>
        <p>t("price")<%= item["sellingStatus"][0]["currentPrice"][0]["__value__"] %> <%= item["sellingStatus"][0]["currentPrice"][0]["@currencyId"] %></p>
        <p>t("link") <%= link_to t("link"), item["viewItemURL"][0] %></p> 
        <% if item["listingInfo"][0]["buyItNowAvailable"][0]=="true" %>
            <%= t("iexp") %>
        <% end %>
      </div>
    <% end %>
  </div>
<% else %>
<p><%=t("nores")%></p>
<% end %>

<% end %>



<%= form_tag(search_path, method: :get) do %>
	<%= text_field_tag :keyword, params[:keyword], placeholder: t("cerca") %>
	<%= select_tag :sort_order, options_for_select([[t("pbasso"), "PricePlusShippingLowest"], [t("palto"), "PricePlusShippingHighest"]], params[:sort_order]), prompt: t("ordine") %>
	<%= label_tag :minprice, t("pbasso")%>
	<%= number_field_tag :minprice, params[:minprice], :value => 1, min: 1%>
	<%= label_tag :maxprice, t("palto")%>
	<%= number_field_tag :maxprice, params[:maxprice], :value => 10000, max: 10000 %></p>
  <%= label_tag :minf, t("fmin")%>
	<%= number_field_tag :minf, params[:minf], :value => 1, max: 100000 %></p>
	<%= label_tag :instaexp, t("iexp")%>
	<%= check_box_tag "instaexp", 1 , false%>
	<%= text_field_tag :place, params[:place], placeholder: t("place") %>

	<%= submit_tag t("cerca") %>
  <% end %>

  <% if current_user && current_user.admin?%>
<%= link_to "Admin", admin_board_path %>
<%end %>


<% if current_user && current_user.role==0 %>
<%= link_to t("assistenza"), new_user_message_path(current_user.id) %>
<%end %>

<%= link_to "Home", root_path %>